package com.squashtrainingapp.ui.activities;

import android.content.Intent;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.TextView;

import androidx.appcompat.app.AppCompatActivity;
import androidx.viewpager2.widget.ViewPager2;

import com.google.android.material.tabs.TabLayout;
import com.google.android.material.tabs.TabLayoutMediator;
import com.squashtrainingapp.R;
import com.squashtrainingapp.SimpleMainActivity;
import com.squashtrainingapp.ui.adapters.OnboardingAdapter;

import java.util.ArrayList;
import java.util.List;

public class OnboardingActivity extends AppCompatActivity {
    
    private ViewPager2 viewPager;
    private TabLayout tabLayout;
    private Button nextButton;
    private Button skipButton;
    private OnboardingAdapter adapter;
    
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_onboarding);
        
        initializeViews();
        setupOnboarding();
    }
    
    private void initializeViews() {
        viewPager = findViewById(R.id.onboarding_viewpager);
        tabLayout = findViewById(R.id.onboarding_tab_layout);
        nextButton = findViewById(R.id.next_button);
        skipButton = findViewById(R.id.skip_button);
    }
    
    private void setupOnboarding() {
        List<OnboardingItem> items = new ArrayList<>();
        
        // Page 1: Welcome
        items.add(new OnboardingItem(
                R.drawable.onboarding_welcome,
                "í™˜ì˜í•©ë‹ˆë‹¤! ðŸŽ‰",
                "ìŠ¤ì¿¼ì‹œ íŠ¸ë ˆì´ë‹ í”„ë¡œì˜ í”„ë¦¬ë¯¸ì—„ ë©¤ë²„ê°€ ë˜ì‹  ê²ƒì„ ì¶•í•˜í•©ë‹ˆë‹¤! 7ì¼ ë¬´ë£Œ ì²´í—˜ì´ ì‹œìž‘ë˜ì—ˆìŠµë‹ˆë‹¤.",
                "#4CAF50"
        ));
        
        // Page 2: AI Coach
        items.add(new OnboardingItem(
                R.drawable.onboarding_ai_coach,
                "AI ê°œì¸ ì½”ì¹˜ ðŸ¤–",
                "GPT-4 ê¸°ë°˜ AI ì½”ì¹˜ê°€ ë‹¹ì‹ ì˜ ì‹¤ë ¥ê³¼ ëª©í‘œì— ë§žì¶˜ ë§žì¶¤í˜• íŠ¸ë ˆì´ë‹ì„ ì œê³µí•©ë‹ˆë‹¤.",
                "#2196F3"
        ));
        
        // Page 3: Analytics
        items.add(new OnboardingItem(
                R.drawable.onboarding_analytics,
                "ìƒì„¸ ë¶„ì„ ðŸ“Š",
                "ìš´ë™ ë°ì´í„°ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ë¶„ì„í•˜ì—¬ ì•½ì ì„ íŒŒì•…í•˜ê³  ê°œì„  ë°©í–¥ì„ ì œì‹œí•©ë‹ˆë‹¤.",
                "#FF9800"
        ));
        
        // Page 4: Social Features
        items.add(new OnboardingItem(
                R.drawable.onboarding_social,
                "ê¸€ë¡œë²Œ ì»¤ë®¤ë‹ˆí‹° ðŸŒ",
                "ì „ ì„¸ê³„ ìŠ¤ì¿¼ì‹œ í”Œë ˆì´ì–´ë“¤ê³¼ ê²½ìŸí•˜ê³ , íŒ€ì„ ë§Œë“¤ì–´ í•¨ê»˜ ë„ì „í•˜ì„¸ìš”!",
                "#9C27B0"
        ));
        
        // Page 5: Get Started
        items.add(new OnboardingItem(
                R.drawable.onboarding_ready,
                "ì¤€ë¹„ë˜ì…¨ë‚˜ìš”? ðŸ’ª",
                "ëª©í‘œë¥¼ ì„¤ì •í•˜ê³  ì²« ìš´ë™ì„ ì‹œìž‘í•´ë³´ì„¸ìš”. AI ì½”ì¹˜ê°€ ëª¨ë“  ë‹¨ê³„ì—ì„œ ë„ì™€ë“œë¦½ë‹ˆë‹¤!",
                "#F44336"
        ));
        
        adapter = new OnboardingAdapter(items);
        viewPager.setAdapter(adapter);
        
        new TabLayoutMediator(tabLayout, viewPager, (tab, position) -> {
            // Tab dots will be automatically handled
        }).attach();
        
        viewPager.registerOnPageChangeCallback(new ViewPager2.OnPageChangeCallback() {
            @Override
            public void onPageSelected(int position) {
                if (position == items.size() - 1) {
                    nextButton.setText("ì‹œìž‘í•˜ê¸°");
                    skipButton.setVisibility(View.GONE);
                } else {
                    nextButton.setText("ë‹¤ìŒ");
                    skipButton.setVisibility(View.VISIBLE);
                }
            }
        });
        
        nextButton.setOnClickListener(v -> {
            int currentItem = viewPager.getCurrentItem();
            if (currentItem < items.size() - 1) {
                viewPager.setCurrentItem(currentItem + 1);
            } else {
                completeOnboarding();
            }
        });
        
        skipButton.setOnClickListener(v -> completeOnboarding());
    }
    
    private void completeOnboarding() {
        // Save onboarding completion
        getSharedPreferences("app_prefs", MODE_PRIVATE)
                .edit()
                .putBoolean("onboarding_completed", true)
                .apply();
        
        // Navigate to goal setting
        Intent intent = new Intent(this, GoalSettingActivity.class);
        startActivity(intent);
        overridePendingTransition(R.anim.slide_in_right, R.anim.slide_out_left);
        finish();
    }
    
    // Data class for onboarding items
    public static class OnboardingItem {
        public final int imageResId;
        public final String title;
        public final String description;
        public final String backgroundColor;
        
        public OnboardingItem(int imageResId, String title, String description, String backgroundColor) {
            this.imageResId = imageResId;
            this.title = title;
            this.description = description;
            this.backgroundColor = backgroundColor;
        }
    }
}